import{_ as n,X as s,Y as a,a3 as p}from"./framework-e83cfa57.js";const t={},e=p(`<h1 id="享元模式" tabindex="-1"><a class="header-anchor" href="#享元模式" aria-hidden="true">#</a> 享元模式</h1><blockquote><p>驾考现场的考试车 众多考生，不是每人一辆考试车，而是共享n辆考试车，轮流来</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> candidateNum <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment">// 考生数量</span>
<span class="token keyword">var</span> examCarNum <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 驾考车数量</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: 驾考车构造函数
 */</span>
<span class="token keyword">function</span> <span class="token function">ExamCar</span><span class="token punctuation">(</span><span class="token parameter">carType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  examCarNum<span class="token operator">++</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">=</span> examCarNum
  <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">=</span> carType <span class="token operator">?</span> <span class="token string">&#39;手动挡&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;自动挡&#39;</span>
<span class="token punctuation">}</span>

<span class="token class-name">ExamCar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">examine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;考生-&#39;</span> <span class="token operator">+</span> candidateId <span class="token operator">+</span> <span class="token string">&#39; 在&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">+</span> <span class="token string">&#39;驾考车-&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">+</span> <span class="token string">&#39;上考试&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> manualExamCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> autoExamCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> candidateId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> candidateId <span class="token operator">&lt;=</span> candidateNum<span class="token punctuation">;</span> candidateId<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> examCar <span class="token operator">=</span> candidateId <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">?</span> manualExamCar <span class="token operator">:</span> autoExamCar
  examCar<span class="token punctuation">.</span><span class="token function">examine</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;驾考车总数-&#39;</span> <span class="token operator">+</span> examCarNum<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到我们使用 2 个驾考车实例就实现了刚刚 10 个驾考车实例实现的功能。这是仅有 10 个考生的情况，如果有几百上千考生，这时我们节约的内存就比较可观了，这就是享元模式要达到的目的。</p><p>享元模式改进</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> examCarNum <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 驾考车总数</span>

<span class="token comment">/* 驾考车对象 */</span>
<span class="token keyword">class</span> <span class="token class-name">ExamCar</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">carType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    examCarNum<span class="token operator">++</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">=</span> examCarNum
    <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">=</span> carType <span class="token operator">?</span> <span class="token string">&#39;手动档&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;自动档&#39;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>usingState <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 是否正在使用</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 在本车上考试 */</span>
  <span class="token function">examine</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>usingState <span class="token operator">=</span> <span class="token boolean">true</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">考生- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>candidateId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 开始在</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>carType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">驾考车- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>carId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 上考试</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usingState <span class="token operator">=</span> <span class="token boolean">false</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">%c考生- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>candidateId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 在</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>carType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">驾考车- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>carId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 上考试完毕</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token string">&#39;color:#f40&#39;</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 0~2秒后考试完毕</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 手动档汽车对象池 */</span>
ManualExamCarPool <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">_pool</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 驾考车对象池</span>
  <span class="token literal-property property">_candidateQueue</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 考生队列</span>

  <span class="token comment">/* 注册考生 ID 列表 */</span>
  <span class="token function">registCandidates</span><span class="token punctuation">(</span><span class="token parameter">candidateList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    candidateList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registCandidate</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/* 注册手动档考生 */</span>
  <span class="token function">registCandidate</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> examCar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getManualExamCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 找一个未被占用的手动档驾考车</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>examCar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      examCar
        <span class="token punctuation">.</span><span class="token function">examine</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span> <span class="token comment">// 开始考试，考完了让队列中的下一个考生开始考试</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> nextCandidateId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_candidateQueue<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_candidateQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          nextCandidateId <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registCandidate</span><span class="token punctuation">(</span>nextCandidateId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_candidateQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/* 注册手动档车 */</span>
  <span class="token function">initManualExamCar</span><span class="token punctuation">(</span><span class="token parameter">manualExamCarNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> manualExamCarNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_pool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/* 获取状态为未被占用的手动档车 */</span>
  <span class="token function">getManualExamCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pool<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">car</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>car<span class="token punctuation">.</span>usingState<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

ManualExamCarPool<span class="token punctuation">.</span><span class="token function">initManualExamCar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 一共有3个驾考车</span>
ManualExamCarPool<span class="token punctuation">.</span><span class="token function">registCandidates</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 10个考生来考试</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="资源池" tabindex="-1"><a class="header-anchor" href="#资源池" aria-hidden="true">#</a> 资源池</h3><p>上面这种改进的模式一般叫做<strong>资源池（Resource Pool）</strong>，或者叫对象池（Object Pool），可以当作是享元模式的升级版，实现不一样，但是目的相同。资源池一般维护一个装载对象的池子，封装有获取、释放资源的方法，当需要对象的时候直接从资源池中获取，使用完毕之后释放资源等待下次被获取。</p><p>在上面的例子中，驾考车相当于有限资源，考生作为访问者根据资源的使用情况从资源池中获取资源，如果资源池中的资源都正在被占用，要么资源池创建新的资源，要么访问者等待占用的资源被释放。</p><p>资源池在后端应用相当广泛，比如缓冲池、连接池、线程池、字符常量池等场景，前端使用场景不多，但是也有使用，比如有些频繁的 DOM 创建销毁操作，就可以引入对象池来节约一些 DOM 创建损耗。</p><p>下面介绍资源池的几种主要应用。</p><ul><li>Event Loop</li><li>缓存</li><li>连接池，一般数据库连接操作 <ul><li>在 Node.js 中使用 mysql 模块的连接池创建连接：<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mysql&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>     <span class="token comment">// 创建数据库连接池</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span>         <span class="token comment">// 用户名</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">,</span>   <span class="token comment">// 密码</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span>       <span class="token comment">// 制定数据库</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">&#39;3306&#39;</span>          <span class="token comment">// 端口号</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 从连接池中获取一个连接，进行增删改查</span>
pool<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> connection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... 数据库操作</span>
    connection<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 将连接释放回连接池中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 关闭连接池</span>
pool<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li>字符常量池</li></ul><h3 id="优缺点" tabindex="-1"><a class="header-anchor" href="#优缺点" aria-hidden="true">#</a> 优缺点</h3><p>优点：</p><ul><li>由于减少了系统中的对象数量，提高了程序运行效率和性能，精简了内存占用，加快运行速度；</li><li>外部状态相对独立，不会影响到内部状态，所以享元对象能够在不同的环境被共享；</li></ul><p>缺点：</p><ul><li>引入了共享对象，使对象结构变得复杂；</li><li>共享对象的创建、销毁等需要维护，带来额外的复杂度（如果需要把共享对象维护起来的话）；</li></ul><h3 id="适用场景" tabindex="-1"><a class="header-anchor" href="#适用场景" aria-hidden="true">#</a> 适用场景</h3><ul><li>如果一个程序中大量使用了相同或相似对象，那么可以考虑引入享元模式；</li><li>如果使用了大量相同或相似对象，并造成了比较大的内存开销；</li><li>对象的大多数状态可以被转变为外部状态；</li><li>剥离出对象的外部状态后，可以使用相对较少的共享对象取代大量对象；</li><li>在一些程序中，如果引入享元模式对系统的性能和内存的占用影响不大时，比如目标对象不多，或者场景比较简单，则不需要引入，以免适得其反。</li></ul><p>1、系统中有大量对象。 2、这些对象消耗大量内存。 3、这些对象的状态大部分可以外部化。 4、这些对象可以按照内蕴状态分为很多组，当把外蕴对象从对象中剔除出来时，每一组对象都可以用一个对象来代替。 5、系统不依赖于这些对象身份，这些对象是不可分辨的。</p>`,20),o=[e];function c(l,i){return s(),a("div",null,o)}const r=n(t,[["render",c],["__file","index.html.vue"]]);export{r as default};
