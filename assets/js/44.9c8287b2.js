(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{450:function(s,e,a){"use strict";a.r(e);var t=a(22),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes"}},[s._v("#")]),s._v(" kubernetes")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("有条件物理机安装者，直接看kebernetes官网安装教程，\n不过可以先在虚拟机安装熟悉流程，节约时间")]),s._v(" "),a("p",[s._v("本地学习可以用虚拟机安装 minikube 版本\n"),a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/tools/install-minikube/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1),s._v("\n简单快捷，我们的目的是了解安装，可以安装使用，而不是在安装过程中消耗太多时间")]),s._v(" "),a("h3",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备：")]),s._v(" "),a("ul",[a("li",[s._v("VMWare 虚拟机软件")]),s._v(" "),a("li",[s._v("CentOS 7 IOS 文件")]),s._v(" "),a("li",[s._v("配置尽量高一点的电脑")]),s._v(" "),a("li",[s._v("有网络，可以访问Google(非必要，遇到疑难杂症帮助很大)")])]),s._v(" "),a("ol",[a("li",[s._v("创建VMWare虚拟机（virtualBox也可以），安装 "),a("code",[s._v("CentOS")]),s._v(" 系统")]),s._v(" "),a("li",[s._v("安装完 CentOS 系统 可以做个快照备份，系统搞崩了不用重新安装，直接快照还原")]),s._v(" "),a("li",[s._v("根据官网安装 "),a("code",[s._v("minikube")])])]),s._v(" "),a("h2",{attrs:{id:"启动-minikube"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-minikube"}},[s._v("#")]),s._v(" 启动 minikube")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("minikube start "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --vm-driver=none 指定 VM 驱动程序 默认 none 在当前主机运行k8s组件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动过程中遇到的问题，国内网络无法拉取镜像，设置国内镜像地址")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("minikube start --image-mirror-country"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn --iso-url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/iso/minikube-v1.6.0.iso --registry-mirror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://dockerhub.azk8s.cn  --image-repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"安装dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装dashboard"}},[s._v("#")]),s._v(" 安装dashboard")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("minikube dashboard\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(base) ➜  ~ * Verifying dashboard health ...\n* Launching proxy ...\n* Verifying proxy health ...\nhttp://127.0.0.1:41730/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("启动后，输出一个url，是访问浏览器访问"),a("code",[s._v("dashboard")]),s._v("的地址，但只能本地访问，要设置代理才能局域网或者公网访问, 详情查看 "),a("code",[s._v("kubectl proxy --help")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(" --accept-hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^*$"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许所有地址访问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Starting to serve on [::]:8001")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在宿主主机浏览器中访问 "),a("code",[s._v("http://<master_ip>:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/")])]),s._v(" "),a("p",[s._v("遇到的问题：\n安装 dashboard 失败问题参考：https://github.com/kubernetes/minikube/issues/5860")]),s._v(" "),a("p",[s._v("启动 dashboard 失败问题参考：https://github.com/kubernetes/minikube/issues/4411")]),s._v(" "),a("h2",{attrs:{id:"部署第一个应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署第一个应用"}},[s._v("#")]),s._v(" 部署第一个应用")]),s._v(" "),a("blockquote",[a("p",[s._v("官网的"),a("a",{attrs:{href:"https://kubernetes.io/zh/docs/tutorials/hello-minikube/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Hello World"),a("OutboundLink")],1),s._v(" 提供在线 kubernetes 环境")])]),s._v(" "),a("p",[s._v("本地 minikube 环境 部署应用")]),s._v(" "),a("blockquote",[a("p",[s._v("参考：https://segmentfault.com/a/1190000014116698\n把命令操作写成 yml 配置文件，方便使用")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("参考资料：\n"),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/39937913",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 和 Kubernetes：给程序员的快速指南"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"利用配置文件创建-pod-deployment-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用配置文件创建-pod-deployment-service"}},[s._v("#")]),s._v(" 利用配置文件创建 Pod Deployment Service")]),s._v(" "),a("p",[s._v("Pod 是 Kubernetes 应用程序的基本执行单元，即它是 Kubernetes 对象模型中创建或部署的最小和最简单的单元。Pod 表示在 集群 上运行的进程。")]),s._v(" "),a("p",[s._v("Pod 是 Kubernetes 抽象出来的，表示一组一个或多个应用程序容器（如 Docker 或 rkt ），以及这些容器的一些共享资源。这些资源包括:")]),s._v(" "),a("ul",[a("li",[s._v("共享存储，当作卷")]),s._v(" "),a("li",[s._v("网络，作为唯一的集群 IP 地址")]),s._v(" "),a("li",[s._v("有关每个容器如何运行的信息，例如容器映像版本或要使用的特定端口。")])]),s._v(" "),a("p",[s._v("Kubernetes Service 定义了这样一种抽象：逻辑上的一组 Pod，一种可以访问它们的策略 —— 通常称为微服务。 这一组 Pod 能够被 Service 访问到，通常是通过 selector （查看下面了解，为什么你可能需要没有 selector 的 Service）实现的。")]),s._v(" "),a("p",[s._v("Service 可以理解成提供对外访问的服务（接口）")]),s._v(" "),a("p",[s._v("Deployment 一个为 "),a("code",[s._v("Pod")]),s._v("和"),a("code",[s._v("ReplicaSets")]),s._v(" 提供声明式更新的调度器。用于管理 Pod。")]),s._v(" "),a("h4",{attrs:{id:"配置文件例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件例子"}},[s._v("#")]),s._v(" 配置文件例子")]),s._v(" "),a("blockquote",[a("p",[s._v("kubectl get 查看列表\nkubectl describe 查看详情\nkubectl logs 查看日志\nkubectl exec 执行容器命令")])]),s._v(" "),a("p",[s._v("本地镜像文件 "),a("code",[s._v("sh5dev:v1")])]),s._v(" "),a("h5",{attrs:{id:"配置-deployment-vim-deployment-sh5-dev-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-deployment-vim-deployment-sh5-dev-yml"}},[s._v("#")]),s._v(" 配置 Deployment "),a("code",[s._v("vim deployment-sh5-dev.yml")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for versions before 1.9.0 use apps/v1beta2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sappdev\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择要管理的 Pod")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("h5dev "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配要管理的 Pod 的标签，没有匹配到会创建一个新的 Pod")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tells deployment to run 2 pods matching the template")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模板")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("h5dev\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定运行的容器，和配置")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh5app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh5dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动用的镜像")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8009")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外暴露的端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("创建 Deployment "),a("code",[s._v("kubectl create -f deployment-sh5-dev.yml")]),s._v(" 创建的Deployment需要运行 "),a("code",[s._v("kubectl run <NAME>")]),s._v(" 这里的 "),a("code",[s._v("NAME=dp-sappdev")]),s._v("\n直接运行 "),a("code",[s._v("kubectl apply -f deployment-sh5-dev.yml")]),s._v("\n查看 "),a("code",[s._v("kubectl get deployment")])]),s._v(" "),a("h5",{attrs:{id:"配置-pod-vim-pod-sh5-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-pod-vim-pod-sh5-yml"}},[s._v("#")]),s._v(" 配置 Pod "),a("code",[s._v("vim pod-sh5.yml")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh5\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("h5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定运行的容器")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("h5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh5dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8009")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("运行 Pod "),a("code",[s._v("kubectl apply -f pod-sh5.yml")]),s._v("\n查看 "),a("code",[s._v("kubectl get pods")])]),s._v(" "),a("h5",{attrs:{id:"配置-service-vim"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-service-vim"}},[s._v("#")]),s._v(" 配置 Service "),a("code",[s._v("vim")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Service\nmetadata:\n  name: sh5dev-svc\n  labels:\n    app: sh5dev-svc\nspec:\n  type: NodePort\n  ports:\n    - port: 8009\n      # nodePort: 30051 # 指定对外暴露的端口，不指定会内部分配 `minikube service sh5dev-svc` 查看访问url\n  selector: # 指定对外暴露的 Pod 的 labels{key,value} 的形式，例子匹配 Pod 的labels 是 app:s-h5dev\n    app: s-h5dev\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("运行 Service "),a("code",[s._v("kubectl apply -f pod-sh5.yml")]),s._v("\n查看 "),a("code",[s._v("kubectl get services")])]),s._v(" "),a("h3",{attrs:{id:"应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用"}},[s._v("#")]),s._v(" 应用")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MjM5MzU5NDYwNA==&mid=2247485698&idx=2&sn=5b2f74a8f0f1d9e383e34da2964e35a3&chksm=a695e48191e26d97d33573cea4cd9d2a1cef463785acd7c7b0ee889e4556839bf9ca5ffdd9f7&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("5分钟搞定在k8s上部署jenkins，并提供域名访问"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Github上的一个项目：\n"),a("a",{attrs:{href:"https://github.com/jenkinsci/kubernetes-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jenkins plugin to run dynamic agents in a Kubernetes/Docker environment"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("上面提供了jenkins在kubernetes中容器化的部署方式，以及yaml文件，现在直接 git clone 下来。在部署好k8s平台上安装 jenkins")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/jenkinsci/kubernetes-plugin.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kubernetes-plugin\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 minikube refe: https://github.com/jenkinsci/kubernetes-plugin#configuration-on-minikube")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端证书需要转换为PKCS(公共秘钥)")]),s._v("\nopenssl pkcs12 -export -out ~/.minikube/minikube.pfx -inkey ~/.minikube/apiserver.key -in ~/.minikube/apiserver.crt -certfile ~/.minikube/ca.crt -passout pass:secret\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检验 认证是否生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --cacert ~/.minikube/ca.crt --cert ~/.minikube/minikube.pfx:secret --cert-type P12 https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(":8443\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("在 minikube 中运行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("minikube start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建命名空间和Service")]),s._v("\nkubectl create namespace kubernetes-plugin\nkubectl config set-context "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl config current-context"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" --namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-plugin\nkubectl create -f src/main/kubernetes/service-account.yml\nkubectl create -f src/main/kubernetes/jenkins.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取访问url")]),s._v("\nminikube "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" jenkins --namespace kubernetes-plugin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在dashboard中访问，会看到 Pods 的状态是 "),a("code",[s._v("Failed")]),s._v(" , 查看日志排查错误，如果日志正常，只需要访问 "),a("code",[s._v("http://<master_ip>:8080")]),s._v(" 安装 Jenkins。如果不正常，需要根据日志 Google 排查问题。")])])}),[],!1,null,null,null);e.default=n.exports}}]);